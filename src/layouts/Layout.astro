---
import "@/styles/tailwind--.css";

import LayoutBase from "./LayoutBase.astro";
import SiteHeader from "./SiteHeader.astro";
import SiteFooter from "./SiteFooter.astro";

import Darkmode from "@/components/DarkMode.astro";
import BackToTop from "@/components/BackToTop.astro";
import HotkeyManager from "@/components/HotkeyManager.astro";

interface Props {
  title?: string | undefined;
  description?: string | undefined;
  empty_canvas?: boolean;
}

const { title, description, empty_canvas = false } = Astro.props as Props;
---

<LayoutBase title={title} description={description}>
  {
    empty_canvas ? (
      <>
        <Darkmode show_button={false} />
        <HotkeyManager />
      </>
    ) : (
      <SiteHeader>
        <Darkmode show_button={false} />
        <HotkeyManager />
      </SiteHeader>
    )
  }

  <slot />

  {
    !empty_canvas && (
      <SiteFooter>
        <div class="flex flex-col gap-2">
          <BackToTop />
          <button id="custom-theme-toggle" class="btn--toggle">
            Toggle Theme
          </button>
        </div>
      </SiteFooter>
    )
  }
</LayoutBase>

<style is:global>
  body {
    display: grid;
    grid-template-rows: 100px 1fr auto;
    grid-template-columns: 1fr;
    grid-template-areas:
      "header"
      "content"
      "footer";
    min-height: 100vh;
  }
  .site--header {
    grid-area: header;
  }
  body > main {
    grid-area: content;
  }
  .site--footer {
    grid-area: footer;
  }
</style>

<script>
  // Register spacebar hotkey for recording toggle
  function initHotkeys() {
    if (window.hotkeyManager) {
      // Global hotkeys
      /* window.hotkeyManager.register(
        " ",
        "Toggle recording",
        () => {
          toggleRecord();
        },
        true
      ); */

      // Console-only hotkeys (only work when console is open)
      window.hotkeyManager.register(
        "1",
        "Go to homepage",
        () => {
          window.location.href = "/";
        },
        true,
        {},
        true
      );
      window.hotkeyManager.register(
        "2",
        "Daily Sketches",
        () => {
          window.location.href = "/dailies";
        },
        true,
        {},
        true
      );
      window.hotkeyManager.register(
        "3",
        "Go to exp--",
        () => {
          window.location.href = "/exp--";
        },
        true,
        {},
        true
      );
      window.hotkeyManager.register(
        "4",
        "Go to toolstack--",
        () => {
          window.location.href = "/toolstack--";
        },
        true,
        {},
        true
      );
      window.hotkeyManager.register(
        "]",
        "Toggle dark mode",
        () => {
          if ((window as any).toggleTheme) {
            (window as any).toggleTheme();
          }
        },
        true,
        {},
        true
      );
      // Add more console hotkeys here:
      // window.hotkeyManager.register('2', 'Action 2', () => { ... }, true, {}, true);
      // window.hotkeyManager.register('3', 'Action 3', () => { ... }, true, {}, true);
      // ... and so on
    } else {
      // Retry if hotkeyManager isn't ready yet
      setTimeout(initHotkeys, 100);
    }
  }

  // Initialize hotkeys when DOM is ready
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initHotkeys);
  } else {
    initHotkeys();
  }
</script>
