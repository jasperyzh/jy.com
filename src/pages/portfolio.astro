---
import Layout from "@/layouts/BaseLayout.astro";
import { SITE_TITLE } from "../consts";

// Portfolio items data
const portfolioItems = [
  {
    title: "Paramount Property",
    category: "Web Development",
    thumbnail: "https://picsum.photos/id/237/1920/1080",
    images: [
      {
        src: "https://picsum.photos/id/237/1920/1080",
        width: 1920,
        height: 1080,
        caption: "Homepage design showcasing property listings",
      },
      {
        src: "https://picsum.photos/id/238/800/600",
        width: 800,
        height: 600,
        caption: "Interactive property search interface",
      },
      {
        src: "https://picsum.photos/id/239/800/600",
        width: 800,
        height: 600,
        caption: "Mobile responsive design",
      },
    ],
    description:
      "Corporate website development for Malaysia's leading property developer",
    tags: ["WordPress", "Custom Theme", "Property Portal"],
    year: "2023",
  },
  {
    title: "E-commerce Platform",
    category: "Full Stack Development",
    thumbnail: "https://picsum.photos/id/240/1920/1080",
    images: [
      {
        src: "https://picsum.photos/id/240/1920/1080",
        width: 1920,
        height: 1080,
        caption: "Product catalog with advanced filtering",
      },
      {
        src: "https://picsum.photos/id/242/800/600",
        width: 800,
        height: 600,
        caption: "Shopping cart and checkout process",
      },
      {
        src: "https://picsum.photos/id/243/800/600",
        width: 800,
        height: 600,
        caption: "Admin dashboard for inventory management",
      },
    ],
    description:
      "Modern e-commerce platform with real-time inventory management",
    tags: ["React", "Node.js", "MongoDB"],
    year: "2023",
  },
  {
    title: "Travel Blog Platform",
    category: "Web Design",
    thumbnail: "https://picsum.photos/id/244/1920/1080",
    images: [
      {
        src: "https://picsum.photos/id/244/1920/1080",
        width: 1920,
        height: 1080,
        caption: "Homepage with featured destinations",
      },
      {
        src: "https://picsum.photos/id/216/800/600",
        width: 800,
        height: 600,
        caption: "Blog post layout with rich media",
      },
      {
        src: "https://picsum.photos/id/217/800/600",
        width: 800,
        height: 600,
        caption: "Interactive map integration",
      },
    ],
    description:
      "Custom blog platform for travel enthusiasts with dynamic content management",
    tags: ["Astro", "TailwindCSS", "Markdown"],
    year: "2024",
  },
  {
    title: "Healthcare Dashboard",
    category: "UI/UX Design",
    thumbnail: "https://picsum.photos/id/248/1920/1080",
    images: [
      {
        src: "https://picsum.photos/id/248/1920/1080",
        width: 1920,
        height: 1080,
        caption: "Patient monitoring dashboard",
      },
      {
        src: "https://picsum.photos/id/250/800/600",
        width: 800,
        height: 600,
        caption: "Medical records interface",
      },
      {
        src: "https://picsum.photos/id/251/800/600",
        width: 800,
        height: 600,
        caption: "Analytics and reporting tools",
      },
    ],
    description:
      "Interactive dashboard for healthcare professionals with real-time patient monitoring",
    tags: ["Vue.js", "D3.js", "Firebase"],
    year: "2023",
  },
  {
    title: "Mobile Banking App",
    category: "Mobile Development",
    thumbnail: "https://picsum.photos/id/252/1920/1080",
    images: [
      {
        src: "https://picsum.photos/id/252/1920/1080",
        width: 1920,
        height: 1080,
        caption: "Mobile banking home screen",
      },
      {
        src: "https://picsum.photos/id/254/800/600",
        width: 800,
        height: 600,
        caption: "Transaction history and analytics",
      },
      {
        src: "https://picsum.photos/id/255/800/600",
        width: 800,
        height: 600,
        caption: "Secure payment interface",
      },
    ],
    description: "Secure and user-friendly mobile banking application",
    tags: ["React Native", "TypeScript", "AWS"],
    year: "2024",
  },
  {
    title: "AI Content Platform",
    category: "Machine Learning",
    thumbnail: "https://picsum.photos/id/256/1920/1080",
    images: [
      {
        src: "https://picsum.photos/id/256/1920/1080",
        width: 1920,
        height: 1080,
        caption: "AI content generation interface",
      },
      {
        src: "https://picsum.photos/id/258/800/600",
        width: 800,
        height: 600,
        caption: "Content optimization dashboard",
      },
      {
        src: "https://picsum.photos/id/259/800/600",
        width: 800,
        height: 600,
        caption: "Analytics and performance metrics",
      },
    ],
    description: "AI-powered content generation and optimization platform",
    tags: ["Python", "TensorFlow", "FastAPI"],
    year: "2024",
  },
];

// Group projects by year
const projectsByYear = portfolioItems.reduce((acc, project) => {
  acc[project.year] = [...(acc[project.year] || []), project];
  return acc;
}, {});

const { exposedPortfolioItems } = Astro.props;
---

<Layout title={`Portfolio - ${SITE_TITLE}`}>
  <main class="container-fluid py-5">
    <div class="container mx-auto gallery-parent">
      <h1 class="display-4 text-center mb-3">Portfolio</h1>
      <p class="lead text-center mb-5">
        A collection of my latest work and creative endeavors
      </p>

      {
        Object.entries(projectsByYear)
          .reverse()
          .map(([year, projects]) => (
            <div class="mb-5">
              <h2 class="h3 mb-4">{year}</h2>
              <div class="masonry-grid">
                {projects.map((item, index) => (
                  <div class="masonry-item" data-index={index}>
                    <div class="card h-100 shadow-sm">
                      <div class="card-img-wrapper">
                        <a
                          href={item.images[0].src}
                          data-pswp-width="1920"
                          data-pswp-height="1080"
                          target="_blank"
                          class="gallery-link"
                        >
                          <img
                            src={item.thumbnail}
                            class="card-img-top gallery-img"
                            alt={item.title}
                            loading="lazy"
                          />
                        </a>

                        {item.images.map((image, imgIndex) =>
                          imgIndex > 0 ? (
                            <a
                              key={imgIndex}
                              href={image.src}
                              data-pswp-width={image.width}
                              data-pswp-height={image.height}
                              target="_blank"
                              class="gallery-link"
                            ></a>
                          ) : null
                        )}

                        {item.images.length > 1 && (
                          <span class="image-count position-absolute top-0 end-0 m-2 badge rounded-pill bg-dark">
                            <i class="bi bi-images" /> {item.images.length}
                          </span>
                        )}
                        <div class="card-img-overlay d-flex align-items-end">
                          <div class="overlay-content w-100 text-white p-3">
                            <h5 class="card-title mb-0">{item.title}</h5>
                          </div>
                        </div>
                      </div>
                      <div class="card-body">
                        <p class="card-text">{item.description}</p>
                        <div class="d-flex flex-wrap gap-2 mb-3">
                          {item.tags.map((tag) => (
                            <span class="badge bg-light text-dark">{tag}</span>
                          ))}
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                          <span class="badge bg-primary">{item.category}</span>
                          <button class="btn btn-sm btn-outline-primary">
                            View Project
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          ))
      }
    </div>
  </main>
</Layout>

<script>
  import PhotoSwipeLightbox from "photoswipe/dist/photoswipe-lightbox.esm.js";

  const lightbox = new PhotoSwipeLightbox({
    gallery: ".gallery-parent",
    children: ".gallery-link",
    pswpModule: () => import("photoswipe/dist/photoswipe.esm.js"),
  });

  lightbox.init();
</script>

<style>
  .masonry-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    grid-gap: 1.5rem;
    grid-auto-flow: dense;
  }

  .masonry-item {
    break-inside: avoid;
    margin-bottom: 1.5rem;
  }

  .card {
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
    overflow: hidden;
  }

  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
  }

  .card-img-wrapper {
    position: relative;
    overflow: hidden;
  }

  .card-img-overlay {
    background: linear-gradient(
      to top,
      rgba(0, 0, 0, 0.7) 0%,
      rgba(0, 0, 0, 0) 100%
    );
    opacity: 0;
    transition: opacity 0.3s ease;

    pointer-events: none;
  }

  .card:hover .card-img-overlay {
    opacity: 1;
  }

  .gallery-img {
    cursor: pointer;
    aspect-ratio: 16/9;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .card:hover .gallery-img {
    transform: scale(1.05);
  }

  .overlay-content {
    background: linear-gradient(
      to top,
      rgba(0, 0, 0, 0.7) 0%,
      rgba(0, 0, 0, 0) 100%
    );
  }

  @media (min-width: 768px) {
    .masonry-grid {
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    }
  }

  @media (min-width: 1200px) {
    .masonry-grid {
      grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
    }
  }

  .badge {
    font-weight: 500;
    letter-spacing: 0.5px;
  }

  /* portfolio--astro theme */
  :root {
    --_placeholder-bg: linear-gradient(transparent, transparent);
    --bg-image-main: url("/assets/backgrounds/bg-main-light-800w.jpg");
    --bg-image-main-curves: url("/assets/backgrounds/bg-main-light.svg");
    --bg-image-subtle-1: var(--_placeholder-bg);
    --bg-image-subtle-2: var(--_placeholder-bg);
    --bg-image-footer: var(--_placeholder-bg);
    --bg-svg-blend-mode: overlay;
    --bg-blend-mode: darken;
    --bg-image-aspect-ratio: 2.25;
    --bg-scale: 1.68;
    --bg-aspect-ratio: calc(var(--bg-image-aspect-ratio) / var(--bg-scale));
    --bg-gradient-size: calc(var(--bg-scale) * 100%);
  }

  :root.theme-dark {
    --bg-image-main: url("/assets/backgrounds/bg-main-dark-800w.jpg");
    --bg-image-main-curves: url("/assets/backgrounds/bg-main-dark.svg");
    --bg-svg-blend-mode: darken;
    --bg-blend-mode: lighten;
  }

  /* These backgrounds are displayed below the fold, so we lazy load them
     once the `.loaded` class has been set.  */
  :root.loaded {
    --bg-image-subtle-1: url("/assets/backgrounds/bg-subtle-1-light-800w.jpg");
    --bg-image-subtle-2: url("/assets/backgrounds/bg-subtle-2-light-800w.jpg");
    --bg-image-footer: url("/assets/backgrounds/bg-footer-light-800w.jpg");
  }

  :root.loaded.theme-dark {
    --bg-image-subtle-1: url("/assets/backgrounds/bg-subtle-1-dark-800w.jpg");
    --bg-image-subtle-2: url("/assets/backgrounds/bg-subtle-2-dark-800w.jpg");
    --bg-image-footer: url("/assets/backgrounds/bg-footer-dark-800w.jpg");
  }

  @media (min-width: 50em) {
    :root {
      --bg-scale: 1;
      --bg-image-main: url("/assets/backgrounds/bg-main-light-1440w.jpg");
    }

    :root.theme-dark {
      --bg-image-main: url("/assets/backgrounds/bg-main-dark-1440w.jpg");
    }

    :root.loaded {
      --bg-image-subtle-1: url("/assets/backgrounds/bg-subtle-1-light-1440w.jpg");
      --bg-image-subtle-2: url("/assets/backgrounds/bg-subtle-2-light-1440w.jpg");
      --bg-image-footer: url("/assets/backgrounds/bg-footer-light-1440w.jpg");
    }

    :root.loaded.theme-dark {
      --bg-image-subtle-1: url("/assets/backgrounds/bg-subtle-1-dark-1440w.jpg");
      --bg-image-subtle-2: url("/assets/backgrounds/bg-subtle-2-dark-1440w.jpg");
      --bg-image-footer: url("/assets/backgrounds/bg-footer-dark-1440w.jpg");
    }
  }
  
  .backgrounds {
    min-height: 100%;
    isolation: isolate;
    background:
    /*noise*/
      url("/assets/backgrounds/noise.png") top center/220px repeat,
      /*footer*/ var(--bg-image-footer) bottom center/var(--bg-gradient-size)
        no-repeat,
      /*header1*/ var(--bg-image-main-curves) top center/var(--bg-gradient-size)
        no-repeat,
      /*header2*/ var(--bg-image-main) top center/var(--bg-gradient-size)
        no-repeat,
      /*base*/ var(--gray-999);
    background-blend-mode:
    /*noise*/
      overlay,
      /*footer*/ var(--bg-blend-mode),
      /*header1*/ var(--bg-svg-blend-mode),
      /*header2*/ normal,
      /*base*/ normal;
  }

  @media (forced-colors: active) {
    /* Deactivate custom backgrounds for high contrast users. */
    .backgrounds {
      background: none;
      background-blend-mode: none;
      --bg-gradient-size: none;
    }
  }
</style>

<style is:global>
  @import "photoswipe/dist/photoswipe.css";

  /* PhotoSwipe Customization */
  .pswp__caption {
    background: rgba(0, 0, 0, 0.75);
    padding: 15px;
    width: 100%;
    position: absolute;
    bottom: 0;
  }

  .pswp__title {
    color: white;
    margin: 0;
    font-size: 1.25rem;
  }

  .pswp__description {
    color: #ccc;
    margin: 5px 0 0;
    font-size: 0.9rem;
  }

  .image-count {
    background: rgba(0, 0, 0, 0.6);
    padding: 0.25rem 0.5rem;
    font-size: 0.8rem;
  }

  .image-count i {
    margin-right: 0.25rem;
  }
</style>
