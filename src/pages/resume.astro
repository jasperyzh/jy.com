---
import Layout from "@/layouts/BaseLayout.astro";

import { getEntry } from "astro:content";
import { Icon } from "astro-icon/components";
import {
  Card,
  CardContent,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle,
} from "@/components/starwind/card";
import { Badge } from "@/components/starwind/badge";
import { Button } from "@/components/starwind/button";

// Get resume data from content collection
const resumeEntry = await getEntry("resume", "index");
if (!resumeEntry) {
  throw new Error("Resume data not found");
}

const {
  contactInfo,
  summary,
  professionalExperience,
  keyProjects,
  personalAchievements,
  professionalPhilosophy,
  technicalExpertise,
  additionalCompetencies,
  education,
  languages,
  interests,
} = resumeEntry.data;
---

<Layout title="Resume - Jasper Yong">
  <div
    class="container container--grid resume__container mx-auto my-8 px-4 max-w-7xl"
  >
    <!-- Hero Section with Contact Info -->
    <header
      class="bg-gradient-to-br from-slate-700 to-slate-800 text-white p-8 rounded-lg shadow-lg mb-10"
    >
      <div
        class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6"
      >
        <div>
          <h1 class="text-3xl md:text-4xl font-bold mb-2">
            {contactInfo.name}
          </h1>
          <a
            href={`https://${contactInfo.website}`}
            class="text-blue-300 hover:text-blue-200 transition-colors duration-300 mb-4 inline-block"
            >{contactInfo.website}</a
          >

          <Button variant="ghost" size="icon">
            <Icon name="bi:github" />
          </Button>
        </div>

        <div class="flex flex-col justify-start gap-1">
          <Button
            variant="ghost"
            size="sm"
            href={`mailto:${contactInfo.email}`}
          >
            <Icon name="bi:envelope" />
            {contactInfo.email}
          </Button>

          <Button
            variant="ghost"
            size="sm"
            href={`https://${contactInfo.github}`}
          >
            <Icon name="bi:github" />
            {contactInfo.github}
          </Button>

          <Button
            variant="ghost"
            size="sm"
            href={`https://${contactInfo.linkedin}`}
          >
            <Icon name="bi:linkedin" />
            {contactInfo.linkedin}
          </Button>

          <Button
            variant="ghost"
            size="sm"
            href={`https://${contactInfo.website}`}
          >
            <Icon name="bi:globe" />
            {contactInfo.website}
          </Button>
          <Button
            variant="ghost"
            size="sm"
            href={`https://${contactInfo.website}`}
          >
            <Icon name="bi:pin" />
            {contactInfo.location}
          </Button>
        </div>
      </div>
    </header>

    <!-- Main Column -->
    <main class="p-0 md:p-4 space-y-10">
      <!-- Professional Summary -->
      <section>
        <h2>Professional Summary</h2>
        <p class="text-lg">{summary}</p>
      </section>

      <!-- Professional Experience -->
      <section>
        <h2>Professional Experience</h2>
        <div class="space-y-6">
          {
            professionalExperience.map((experience) => (
              <div class="bg-white p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-3 gap-2">
                  <h3 class="text-xl font-bold">{experience.role}</h3>
                  <div class="flex items-center gap-2">
                    <span class="text-gray-600">{experience.company}</span>
                    <Badge variant="outline">{experience.period}</Badge>
                  </div>
                </div>

                <p class="text-gray-700 mb-4">{experience.description}</p>

                <div class="space-y-4">
                  {experience.highlights.map((highlight) => (
                    <div>
                      <p class="text-gray-700">{highlight}</p>
                    </div>
                  ))}
                </div>
              </div>
            ))
          }
        </div>
      </section>

      <!-- Key Projects -->
      <section>
        <h2 class="text-2xl font-bold mb-4 pb-2 border-b border-gray-200">
          Key Projects
        </h2>

        <div class="grid grid-cols-1 gap-6">
          {
            keyProjects.map((project) => (
              <Card>
                <CardHeader>
                  <CardTitle>{project.name}</CardTitle>
                </CardHeader>
                <CardContent>
                  <p>{project.description}</p>
                  <ul class="list-disc list-inside mt-2">
                    {project.highlights.map((highlight) => (
                      <li class="font-medium">{highlight}</li>
                    ))}
                  </ul>
                </CardContent>
              </Card>
            ))
          }
        </div>
      </section>

      <!-- Personal Achievements -->
      <section>
        <h2 class="text-2xl font-bold mb-4 pb-2 border-b border-gray-200">
          Personal Achievements
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          {
            personalAchievements.map((achievement) => (
              <div class="bg-white p-4 rounded-lg shadow-sm">
                <p class="text-gray-700">{achievement}</p>
              </div>
            ))
          }
        </div>
      </section>

      <!-- Professional Philosophy -->
      <section>
        <h2 class="text-2xl font-bold mb-4 pb-2 border-b border-gray-200">
          Professional Philosophy
        </h2>

        <div class="bg-white p-6 rounded-lg shadow-sm">
          <p class="text-gray-700">{professionalPhilosophy}</p>
        </div>
      </section>

    </main>

    <!-- Sidebar -->
    <aside class="space-y-8">
      <!-- Technical Expertise -->
      <section class="bg-gray-50 p-6 rounded-lg shadow-sm">
        <h2 class="text-xl font-bold mb-4 pb-2 border-b border-gray-200">
          Technical Expertise
        </h2>

        <div class="space-y-6">
          <div>
            <h3 class="font-semibold mb-3">Languages</h3>
            <div class="flex flex-wrap gap-2">
              {
                technicalExpertise.languages.map((lang) => (
                  <Badge>{lang}</Badge>
                ))
              }
            </div>
          </div>

          <div>
            <h3 class="font-semibold mb-3">Frontend Technologies</h3>
            <div class="flex flex-wrap gap-2">
              {
                technicalExpertise.frontendTechnologies.map((tech) => (
                  <Badge>{tech}</Badge>
                ))
              }
            </div>
          </div>

          <div>
            <h3 class="font-semibold mb-3">Backend Technologies</h3>
            <div class="flex flex-wrap gap-2">
              {
                technicalExpertise.backendTechnologies.map((tech) => (
                  <Badge>{tech}</Badge>
                ))
              }
            </div>
          </div>

          <div>
            <h3 class="font-semibold mb-3">Tools</h3>
            <div class="flex flex-wrap gap-2">
              {technicalExpertise.tools.map((tool) => <Badge>{tool}</Badge>)}
            </div>
          </div>

          <div>
            <h3 class="font-semibold mb-3">Design Software</h3>
            <div class="flex flex-wrap gap-2">
              {
                technicalExpertise.designSoftware.map((software) => (
                  <Badge>{software}</Badge>
                ))
              }
            </div>
          </div>

          <div>
            <h3 class="font-semibold mb-3">Databases</h3>
            <div class="flex flex-wrap gap-2">
              {technicalExpertise.databases.map((db) => <Badge>{db}</Badge>)}
            </div>
          </div>
        </div>
      </section>

      <!-- Additional Competencies -->
      <section class="bg-gray-50 p-6 rounded-lg shadow-sm">
        <h2 class="text-xl font-bold mb-4 pb-2 border-b border-gray-200">
          Additional Competencies
        </h2>

        <div class="space-y-3">
          {
            additionalCompetencies.map((competency) => (
              <div class="flex justify-between items-center">
                <span class="font-medium">{competency}</span>
                <div class="w-1/2 bg-gray-200 rounded-full h-2">
                  <div
                    class="bg-blue-600 h-2 rounded-full skill-bar-inner"
                    data-width="90%"
                  />
                </div>
              </div>
            ))
          }
        </div>
      </section>

      <!-- Education -->
      <section class="bg-gray-50 p-6 rounded-lg shadow-sm">
        <h2 class="text-xl font-bold mb-4 pb-2 border-b border-gray-200">
          Education
        </h2>

        <div class="space-y-4">
          {
            education.map((edu) => (
              <div class="relative pl-6 before:content-[''] before:absolute before:left-0 before:top-2 before:w-3 before:h-3 before:bg-blue-600 before:rounded-full before:z-10 after:content-[''] after:absolute after:left-1.5 after:top-2 after:h-full after:w-px after:bg-gray-300 after:-z-10">
                <h3 class="font-semibold">{edu.degree}</h3>
                <p class="text-gray-600">{edu.institution}</p>
                <p class="text-gray-500">({edu.year})</p>
                <ul class="list-disc list-inside mt-2">
                  {edu.highlights.map((highlight) => (
                    <li class="text-gray-600">{highlight}</li>
                  ))}
                </ul>
              </div>
            ))
          }
        </div>
      </section>

      <!-- Languages -->
      <section class="bg-gray-50 p-6 rounded-lg shadow-sm">
        <h2 class="text-xl font-bold mb-4 pb-2 border-b border-gray-200">
          Languages
        </h2>

        <div class="space-y-3">
          {
            languages.map((lang) => (
              <div class="flex justify-between items-center">
                <span class="font-medium">{lang.language}</span>
                <div class="w-1/2 bg-gray-200 rounded-full h-2">
                  <div
                    class="bg-blue-600 h-2 rounded-full skill-bar-inner"
                    data-width="90%"
                  />
                </div>
              </div>
            ))
          }
        </div>
      </section>

      <!-- Interests & Continuous Learning -->
      <section class="bg-gray-50 p-6 rounded-lg shadow-sm">
        <h2 class="text-xl font-bold mb-4 pb-2 border-b border-gray-200">
          Interests & Continuous Learning
        </h2>

        <div class="space-y-4">
          <div>
            <h3 class="font-semibold mb-3">Interests</h3>
            <div class="flex flex-wrap gap-2">
              {
                interests.map((interest) => (
                  <Badge variant="secondary">{interest}</Badge>
                ))
              }
            </div>
          </div>
        </div>
      </section>
    </aside>

    <!-- QR Code Section -->
    <section id="resume__cta" class="justify-self-center">
      <div
        class="bg-white p-6 rounded-lg shadow-sm flex flex-col md:flex-row justify-between items-center gap-6"
      >
        <div>
          <img
            src="/img/placeholder.png"
            alt="QR Code to website"
            class="max-w-48 aspect-square object-cover"
          />
          <Button variant="outline">
            <i class="bi bi-download mr-2"></i>
            Download Resume
          </Button>
          <p class="text-gray-700 italic mb-2 not-print:hidden">
            References available upon request.
          </p>
        </div>
      </div>
    </section>
  </div>
</Layout>

<script>
  // Add animation and interactivity
  document.addEventListener("DOMContentLoaded", () => {
    // Skill bar animations
    const skillBars =
      document.querySelectorAll<HTMLElement>(".skill-bar-inner");
    skillBars.forEach((bar) => {
      const width = bar.getAttribute("data-width");
      setTimeout(() => {
        if (width) {
          bar.style.width = width;
        }
      }, 300);
    });

    // Dark mode toggle
    const themeToggleBtn = document.querySelector("button:has(.bi-moon-stars)");
    if (themeToggleBtn) {
      themeToggleBtn.addEventListener("click", () => {
        document.documentElement.classList.toggle("dark");
      });
    }

    // Download resume placeholder
    const downloadBtn = document.querySelector("button:has(.bi-download)");
    if (downloadBtn) {
      downloadBtn.addEventListener("click", () => {
        alert("Resume download functionality would be implemented here!");
      });
    }
  });
</script>


<style>
  /* default styles */
  h2 {
    font-size: var(--text-2xl);
    font-weight: var(--font-weight-bold);
    border-bottom: 1px solid var(--color-gray-200);
  }

  .resume__container {
    grid-template-rows: auto auto auto;

    #resume__cta {
      /* grid-row: 2 / 3; */
    }

    @media (min-width: 1024px) {
      & > main {
        grid-column: 1 / span 4;
      }
      & > aside {
        grid-column: 5 / span 2;
        grid-row: 2 / -1;
      }
      #resume__cta {
        grid-column: 1 / span 4;
        grid-row: -2 / -1;
      }
    }
  }
</style>