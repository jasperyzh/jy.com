---
// - [[251104-astro_js infinite lazyloading vue js sketches]] - want to load sketches

import Layout from "@/layouts/Layout.astro";
// import SketchContainer from "@/components/load_vue_sketches--SketchContainer.vue";
import SketchContainer from "./_load_vue_sketches--SketchContainer.vue";

const initialSketches = [
  { id: 1, type: "sketch" },
  // { id: 2, type: "calculator" },
];

/* 
  How This Page Works: A Deep Dive

  This setup demonstrates a powerful pattern in Astro called "Astro Islands" or "Partial Hydration".
  We're combining the best of Astro (static, fast HTML) and Vue (dynamic, interactive components).

  1. `load-sketches.astro` (This file):
    - Acts as the main page, rendered on the server.
    - It defines `initialSketches`, a simple JavaScript array containing the data for the first components to display.
    - It renders the `<SketchContainer>` component and passes `initialSketches` to it as a prop.
    - `client:load` is a crucial directive. It tells Astro to immediately hydrate the Vue component on the client-side (in the browser), making it interactive right away.

  2. `SketchContainer.vue`:
    - This is a standard Vue 3 component that manages the display and dynamic loading of sketches.
    - It accepts `initialSketches` as a prop and uses it to populate its initial state.
    - It contains a "Load More" button. When clicked, the `loadMore` method is triggered.
    - The `loadMore` method makes a `fetch` request to our API endpoint (`/api/get-sketches.json.ts`).
    - When the new sketch data arrives, it's appended to the `sketches` array, and Vue's reactivity system automatically renders the new components.
    - It uses `v-if` and `v-else-if` to conditionally render either `GoldenRatioSketch` or `GoldenRatioCalculator` based on the `type` property of each sketch object. This ensures the correct props (like `:sketchId`) are passed to the right components.

  3. `GoldenRatioSketch.vue` & `GoldenRatioCalculator.vue`:
    - These are the actual "sketch" components.
    - They are simple, reusable Vue components that are dynamically rendered by `SketchContainer.vue`.
    - `GoldenRatioSketch` expects a `sketchId` prop, which is why the explicit rendering in the container is important.

  4. `/pages/api/get-sketches.json.ts`:
    - This is an Astro API route. It's a server-side endpoint that only runs on the server.
    - It receives `start` and `count` query parameters from the `fetch` request in `SketchContainer.vue`.
    - It slices a predefined array (`allSketches`) to simulate pagination and returns the next batch of sketch data as JSON.

  The Flow:
  - User visits the page.
  - Astro serves the static HTML, including the initial sketch(es).
  - The `client:load` directive loads and runs the Vue code for `SketchContainer`.
  - The user clicks "Load More".
  - `SketchContainer` fetches data from the API.
  - The API returns more sketch data.
  - Vue updates the component's state, and new sketches appear on the page without a full page reload.
*/
---

<Layout
  title="Lazy Loading Sketches"
  description="Demonstration of Astro Islands lazy-loading with a 'Load More' button."
>
  <main class="container">
    <!-- 
      This is a detailed breakdown of how the components on this page work together.

      1. `Layout.astro`: 
         - This is the master template for the page, providing the common HTML structure (head, header, footer, etc.).

      2. `h1` and `p`:
         - These are standard static HTML elements rendered by Astro on the server. They are fast to load because they are not interactive.

      3. `SketchContainer.vue`:
         - This is where the magic happens. It's a Vue component that gets "hydrated" in the browser.
         - `initialSketches={initialSketches}`: We're passing the data for the first sketch(es) from our Astro frontmatter directly into the Vue component as a prop.
         - `client:load`: This directive tells Astro to make the component interactive as soon as the page loads.
         - Inside this component is the "Load More" button and the logic to fetch and display more sketches from the API endpoint, all handled by Vue.
    -->
    <h1>Astro Islands Lazy-Loading Demo</h1>
    <p>
      Scroll down to see the initial sketches load. Then, click the button to
      dynamically load more sketches.
    </p>

    <SketchContainer initialSketches={initialSketches} client:load />
  </main>
</Layout>